[{"code":[],"body":"If you're upgrading an existing application, it's a great idea to have good test\ncoverage before going in. You should also first upgrade to Rails 4.0 in case you\nhaven't and make sure your application still runs as expected before attempting\nan update to Rails 4.1. A list of things to watch out for when upgrading is\navailable in the\nUpgrading Ruby on Rails\nguide.","title":"1 Upgrading to Rails 4.1","anchor":"#upgrading-to-rails-4-1"},{"title":"2 Major Features","anchor":"#major-features","code":[],"body":""},{"title":"2.1 Spring Application Preloader","anchor":"#spring-application-preloader","code":["\n$ bin/rake test:models\n\nbin/rake test:models\n\nCopy\n","\n$ bin/rails console\n\nbin/rails console\n\nCopy\n","\n$ bin/spring status\nSpring is running:\n\n 1182 spring server | my_app | started 29 mins ago\n 3656 spring app    | my_app | started 23 secs ago | test mode\n 3746 spring app    | my_app | started 10 secs ago | development mode\n\nbin/spring status\n\nCopy\n"],"body":"Spring is a Rails application preloader. It speeds up development by keeping\nyour application running in the background so you don't need to boot it every\ntime you run a test, rake task or migration.New Rails 4.1 applications will ship with \"springified\" binstubs. This means\nthat bin/rails and bin/rake will automatically take advantage of preloaded\nspring environments.Running rake tasks:Running a Rails command:Spring introspection:Have a look at the\nSpring README to\nsee all available features.See the Upgrading Ruby on Rails\nguide on how to migrate existing applications to use this feature."},{"title":"2.2 config/secrets.yml","anchor":"#config-secrets-yml","code":["\ndevelopment:\n  secret_key_base: 3b7cd727ee24e8444053437c36cc66c3\n  some_api_key: SOMEKEY\n\ndevelopment:\n  secret_key_base: 3b7cd727ee24e8444053437c36cc66c3\n  some_api_key: SOMEKEY\n\nCopy\n"],"body":"Rails 4.1 generates a new secrets.yml file in the config folder. By default,\nthis file contains the application's secret_key_base, but it could also be\nused to store other secrets such as access keys for external APIs.The secrets added to this file are accessible via Rails.application.secrets.\nFor example, with the following config/secrets.yml:Rails.application.secrets.some_api_key returns SOMEKEY in the development\nenvironment.See the Upgrading Ruby on Rails\nguide on how to migrate existing applications to use this feature."},{"title":"2.3 Action Pack Variants","anchor":"#action-pack-variants","code":["\nrequest.variant = :tablet if request.user_agent =~ /iPad/\n\nrequest.variant = :tablet if request.user_agent =~ /iPad/\n\nCopy\n","\nrespond_to do |format|\n  format.html do |html|\n    html.tablet # renders app/views/projects/show.html+tablet.erb\n    html.phone { extra_setup; render ... }\n  end\nend\n\nrespond_to do |format|\n  format.html do |html|\n    html.tablet # renders app/views/projects/show.html+tablet.erb\n    html.phone { extra_setup; render ... }\n  end\nend\n\nCopy\n","\napp/views/projects/show.html.erb\napp/views/projects/show.html+tablet.erb\napp/views/projects/show.html+phone.erb\n\napp/views/projects/show.html.erb\napp/views/projects/show.html+tablet.erb\napp/views/projects/show.html+phone.erb\n\nCopy\n","\nrespond_to do |format|\n  format.js         { render \"trash\" }\n  format.html.phone { redirect_to progress_path }\n  format.html.none  { render \"trash\" }\nend\n\nrespond_to do |format|\n  format.js         { render \"trash\" }\n  format.html.phone { redirect_to progress_path }\n  format.html.none  { render \"trash\" }\nend\n\nCopy\n"],"body":"We often want to render different HTML/JSON/XML templates for phones,\ntablets, and desktop browsers. Variants make it easy.The request variant is a specialization of the request format, like :tablet,\n:phone, or :desktop.You can set the variant in a before_action:Respond to variants in the action just like you respond to formats:Provide separate templates for each format and variant:You can also simplify the variants definition using the inline syntax:"},{"code":["\nclass NotifierPreview < ActionMailer::Preview\n  def welcome\n    Notifier.welcome(User.first)\n  end\nend\n\nclass NotifierPreview < ActionMailer::Preview\n  def welcome\n    Notifier.welcome(User.first)\n  end\nend\n\nCopy\n"],"body":"Action Mailer previews provide a way to see how emails look by visiting\na special URL that renders them.You implement a preview class whose methods return the mail object you'd like\nto check:The preview is available in http://localhost:3000/rails/mailers/notifier/welcome,\nand a list of them in http://localhost:3000/rails/mailers.By default, these preview classes live in test/mailers/previews.\nThis can be configured using the preview_path option.See its\ndocumentation\nfor a detailed write up.","title":"2.4 Action Mailer Previews","anchor":"#action-mailer-previews"},{"title":"2.5 Active Record enums","anchor":"#active-record-enums","code":["\nclass Conversation < ActiveRecord::Base\n  enum status: [ :active, :archived ]\nend\n\nconversation.archived!\nconversation.active? # => false\nconversation.status  # => \"archived\"\n\nConversation.archived # => Relation for all archived Conversations\n\nConversation.statuses # => { \"active\" => 0, \"archived\" => 1 }\n\nclass Conversation < ActiveRecord::Base\n  enum status: [ :active, :archived ]\nend\n\nconversation.archived!\nconversation.active? # => false\nconversation.status  # => \"archived\"\n\nConversation.archived # => Relation for all archived Conversations\n\nConversation.statuses # => { \"active\" => 0, \"archived\" => 1 }\n\nCopy\n"],"body":"Declare an enum attribute where the values map to integers in the database, but\ncan be queried by name.See its\ndocumentation\nfor a detailed write up."},{"title":"2.6 Message Verifiers","anchor":"#message-verifiers","code":["\nsigned_token = Rails.application.message_verifier(:remember_me).generate(token)\nRails.application.message_verifier(:remember_me).verify(signed_token) # => token\n\nRails.application.message_verifier(:remember_me).verify(tampered_token)\n# raises ActiveSupport::MessageVerifier::InvalidSignature\n\nsigned_token = Rails.application.message_verifier(:remember_me).generate(token)\nRails.application.message_verifier(:remember_me).verify(signed_token) # => token\n\nRails.application.message_verifier(:remember_me).verify(tampered_token)\n# raises ActiveSupport::MessageVerifier::InvalidSignature\n\nCopy\n"],"body":"Message verifiers can be used to generate and verify signed messages. This can\nbe useful to safely transport sensitive data like remember-me tokens and\nfriends.The method Rails.application.message_verifier returns a new message verifier\nthat signs messages with a key derived from secret_key_base and the given\nmessage verifier name:"},{"code":["\nclass Todo < ActiveRecord::Base\n  concerning :EventTracking do\n    included do\n      has_many :events\n    end\n\n    def latest_event\n      # ...\n    end\n\n    private\n      def some_internal_method\n        # ...\n      end\n  end\nend\n\nclass Todo < ActiveRecord::Base\n  concerning :EventTracking do\n    included do\n      has_many :events\n    end\n\n    def latest_event\n      # ...\n    end\n\n    private\n      def some_internal_method\n        # ...\n      end\n  end\nend\n\nCopy\n"],"body":"A natural, low-ceremony way to separate responsibilities within a class:This example is equivalent to defining a EventTracking module inline,\nextending it with ActiveSupport::Concern, then mixing it in to the\nTodo class.See its\ndocumentation\nfor a detailed write up and the intended use cases.","title":"2.7 Module#concerning","anchor":"#module-concerning"},{"title":"2.8 CSRF protection from remote <script> tags","anchor":"#csrf-protection-from-remote-script-tags","code":[],"body":"Cross-site request forgery (CSRF) protection now covers GET requests with\nJavaScript responses, too. That prevents a third-party site from referencing\nyour JavaScript URL and attempting to run it to extract sensitive data.This means any of your tests that hit .js URLs will now fail CSRF protection\nunless they use xhr. Upgrade your tests to be explicit about expecting\nXmlHttpRequests. Instead of post :create, format: :js, switch to the explicit\nxhr :post, :create, format: :js."},{"title":"3 Railties","anchor":"#railties","code":[],"body":"Please refer to the\nChangelog\nfor detailed changes."},{"title":"3.1 Removals","anchor":"#railties-removals","code":[],"body":""},{"code":[],"body":"","title":"3.2 Notable changes","anchor":"#railties-notable-changes"},{"code":[],"body":"Please refer to the\nChangelog\nfor detailed changes.","title":"4 Action Pack","anchor":"#action-pack"},{"title":"4.1 Removals","anchor":"#action-pack-removals","code":[],"body":""},{"code":[],"body":"","title":"4.2 Notable changes","anchor":"#action-pack-notable-changes"},{"code":[],"body":"Please refer to the\nChangelog\nfor detailed changes.","title":"5 Action Mailer","anchor":"#action-mailer"},{"title":"5.1 Notable changes","anchor":"#action-mailer-notable-changes","code":[],"body":""},{"code":[],"body":"Please refer to the\nChangelog\nfor detailed changes.","title":"6 Active Record","anchor":"#active-record"},{"title":"6.1 Removals","anchor":"#active-record-removals","code":[],"body":""},{"code":[],"body":"","title":"6.2 Deprecations","anchor":"#active-record-deprecations"},{"code":[],"body":"  Before this change when you defined a default_scope in a model\n  it was overridden by chained conditions in the same field. Now it\n  is merged like any other scope. More Details.","title":"6.3 Notable changes","anchor":"#active-record-notable-changes"},{"code":[],"body":"Please refer to the\nChangelog\nfor detailed changes.","title":"7 Active Model","anchor":"#active-model"},{"title":"7.1 Deprecations","anchor":"#active-model-deprecations","code":[],"body":""},{"code":[],"body":"","title":"7.2 Notable changes","anchor":"#active-model-notable-changes"},{"code":[],"body":"Please refer to the\nChangelog\nfor detailed changes.","title":"8 Active Support","anchor":"#active-support"},{"title":"8.1 Removals","anchor":"#active-support-removals","code":[],"body":""},{"code":[],"body":"","title":"8.2 Deprecations","anchor":"#deprecations"},{"code":[],"body":"","title":"8.3 Notable changes","anchor":"#active-support-notable-changes"},{"code":[],"body":"See the\nfull list of contributors to Rails for\nthe many people who spent many hours making Rails, the stable and robust\nframework it is. Kudos to all of them.","title":"9 Credits","anchor":"#credits"}]